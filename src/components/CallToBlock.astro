<div class="call-to min-h-96">
  <h2 class="text-center">
    <span
      class="inline-block text-3xl p-6 bg-emerald-light text-blue-call -mt-20 rounded-xs shadow-lg z-10"
      >Publicación de la convocatoria<br class="mb-4" />24 de febrero de 2025</span
    >
  </h2>
  <div class="container mx-auto my-8 p-4 text-center">
    <form action="" method="post" id="email-form">
      <label for="email" class="block py-4"
        >¿Quieres que te avisemos en cuanto salga?</label
      >
      <input
        type="email"
        name="email"
        id="email"
        class="block w-1/3 mx-auto bg-gray-100 border border-gray-300 p-2 my-3 rounded-sm text-center"
        placeholder="Registra aquí tu correo electrónico"
      />
      <button
        type="submit"
        class="bg-emerald-light hover:bg-emerald-dark hover:text-white mt-4 py-2 px-4 rounded"
        >¡Sí quiero!</button
      >
    </form>
  </div>
  <!-- Modal -->
  <div
    id="success-modal"
    class="fixed inset-0 flex items-center justify-center z-50 hidden transition-opacity duration-300"
  >
    <div
      class="fixed inset-0 bg-black opacity-50 transition-opacity duration-300"
    >
    </div>
    <div
      class="bg-white p-6 rounded-lg shadow-lg z-10 max-w-md w-full transform scale-95 opacity-0 transition-all duration-300"
    >
      <h2 class="text-xl font-bold mb-4">¡Gracias por registrarte!</h2>
      <p class="mb-4">Hemos registrado tu correo correctamente.</p>
      <button
        id="close-modal"
        class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded w-full"
      >
        Cerrar
      </button>
    </div>
  </div>
</div>

<script is:inline>
  function showModal() {
    const modal = document.getElementById("success-modal");
    modal.classList.remove("hidden");
    setTimeout(() => {
      modal.querySelector(".bg-black").classList.remove("opacity-0");
      modal
        .querySelector(".bg-white")
        .classList.remove("scale-95", "opacity-0");
    }, 10);
  }

  function hideModal() {
    const modal = document.getElementById("success-modal");
    modal.querySelector(".bg-black").classList.add("opacity-0");
    modal.querySelector(".bg-white").classList.add("scale-95", "opacity-0");
    setTimeout(() => {
      modal.classList.add("hidden");
    }, 300); // Duración de la animación
  }

  // Manejar el envío del formulario
  document
    .getElementById("email-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = document.getElementById("email").value;

      try {
        const response = await fetch("https://ada.bunam.unam.mx/mo-api/collect", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email }),
        });

        const result = await response.json();

        if (response.ok) {
          showModal(); // Mostrar el modal si el correo se registra correctamente
        } else {
          alert(result.message || "Hubo un error al procesar tu solicitud.");
        }
      } catch (error) {
        console.error("Error al enviar el formulario:", error);
        alert("Hubo un error al enviar el formulario.");
      }
    });

  // Cerrar el modal cuando se hace clic en el botón "Cerrar"
  document.getElementById("close-modal").addEventListener("click", () => {
    hideModal();
  });
</script>
